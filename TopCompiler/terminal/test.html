<!-- <!doctype html>
<html>
<head></head>
<body>

-->
    <link rel="stylesheet" type="text/css" href="terminal.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="terminal.js"></script>
    <script src="../runtime.js"></script>
    <div id="terminal" style="position: relative; height: 100%; width: 100%; float: right;"></div>

    <script>
        var socket = io.connect('http://127.0.0.1:8080/');
        var isCode = true;

        var terminal = $('#terminal').terminal(function(command) {
            try {
                socket.emit("data", command);
            } catch (e) {
                this.error(new String(e));
            }
        }, {
            greetings: 'Top Repl',
            height: 700,
            prompt: "> ",
        });

        socket.on("connect", function() {
            socket.emit("new");
        })

        socket.on("error", function(err) {
            isCode = false;
            terminal.set_prompt("> ");
            terminal.error(err);
            isCode = true;
        })

        socket.on("comp_error", function(err) {
            err = err.replace("\n", "<br>").replace("\t", "&nsbt;&nsbt;&nsbt;&nsbt;");
        })

        socket.on('reload', function (data) {
            console.log("\\n======== reloaded =========");

            document.getElementById("code").innerHTML = "";
            eval(data);
        });

        socket.on('style', function (data) {
            var name = data.name;
            var content = data.content;
            console.log("\\n==== reloaded stylesheets ====");
            document.getElementById(name).innerHTML = content;
        });

        socket.on("code", function(command) {
            isCode = false;
            terminal.set_prompt("> ");
            try {
                log = function(d) {
                    terminal.echo(d);
                };
                log_unop = function(data, next) {
                    terminal.echo(data);
                    next();
                }
                reply = function(d, t) {
                    terminal.echo(dumpObject(d) + " : " + t)
                };
                window.eval(command);
            } catch (e) {
                terminal.error(new String(e));
            }
            isCode = true;
        })

        socket.on("prefix", function(command) {
            terminal.set_prompt(command + " ");
        })
    </script>

<!--
</body>

</html>
-->