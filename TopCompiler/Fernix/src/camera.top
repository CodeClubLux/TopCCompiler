import "ecs"
import "math"
import "runner"

type Camera =
    entity: &ecs.Entity

    projection_matrix: math.Mat4x4
    view_matrix: math.Mat4x4

    position: math.Vec3
    direction: math.Vec3

    fov: uint

def Camera.get_entity(&self) &ecs.Entity =
    self.entity

def Camera.render(&self) =
def Camera.update(&self) =

def Camera.update_matrices(&self) =
    w := (runner.get_game!).window

    self.projection_matrix = math.perspective
        math.radians self.fov
        (w.width as float) / (w.height as float)
        0.1
        100.0

    self.view_matrix = math.identity_mat!

    math.translate &self.view_matrix, math.Vec3{ 0, 0, -1.8 }

def make_CameraSystem() &ecs.Store[Camera] =
    entity := ecs.make_Entity!

    system := ecs.make_Store::[Camera]!

    _ := system.add_component Camera{
        entity = entity

        projection_matrix = math.identity_mat!
        view_matrix = math.identity_mat!

        position = math.Vec3{0,0,0}
        direction = math.Vec3{0,0,0}

        fov = 110
    }

    system

camera_system := make_CameraSystem!

#addToContext camera := &camera_system.components[0]

def get_camera() &Camera =
    context.camera