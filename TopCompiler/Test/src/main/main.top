from "html" import (h1,span,p,br,button,app,div,style,render,onClick,comp,Event,VNode,mapView,toEffect)

type Gender either
    Male
    Female

type Data =
    gender: Gender
    color: string

let data = [
    Data{Male, "blue"}
    Data{Male, "blue"}
    Data{Female, "pink"}
    Data{Female, "red"}
]

def for[A,T,X](func: |A,X| -> (Maybe[T],X), _state: X, arr: []A) []T =
    var state = _state
    var new = [] as []T
    let length = arr.length
    var i = 0

    while i < length do
        let tx = func arr[i], state

        let t = tx.0
        state = tx.1

        new = match t with
            Some tmp -> new.append tmp
            None -> new

        i += 1

    new

let unique = for (|elem: string, indiv: []string|
    if not (indiv.has elem) then
        ((Some elem), indiv.append elem)
    else
        (None, indiv)
), []

def categorize(arr: []Data) [](string, int, int) =
    let colors = unique arr.map |i| i.color

    def transform(c: string) (string,int,int) =
        (
            c
            (arr.filter |i: Data|
                match i.gender with
                    Male -> i.color == c
                    _ -> false
            ).length
            (arr.filter |i: Data|
                match i.gender with
                    Female -> i.color == c
                    _ -> false
            ).length
        )

    colors.map transform

def toHtml(arr: [](string,int,int)) VNode =
    let total = arr.reduce |a,b|
        (a.0, a.1 + b.1, b.2 + a.2)

    div [], [
        div [], ["Color", "Boy", "Girls", "total"].map |i| h1 [style "display: inline; margin-right: 20px;"], i
        arr.map |i|
            h1 [], "{i.0} |||||| {i.1} |||| {i.2} ||||||||| {i.1 + i.2}"
        h1 [], "colours {total.1} |||||| {total.2} ||||||| {total.1 + total.2}"
    ]

//def r(elem: int, indiv: []int) (Maybe[int], []int) =

def r(i: []int) []int =
    def func(elem: int, state: int) (Maybe[int], int) =
        ((Some elem - state), elem)

    for func, i[0], i.slice 1, i.length

let add = |a: int,b:int| a + b


log (add 20)(30)
//render (p [], "hello world") //r [2,3,4,-4,0] //).map |i| if i > -1 then ("+{i}") else toString i

//render p [], toHtml categorize data

/*
//update
let add = toEffect |x: int, ev| x + 1
let sub = toEffect |x: int, ev| if x == 0 then 0 else x - 1

let reset = toEffect |x: int, ev| 0

let append = toEffect |x: []int, ev| x.append 0
let remove = toEffect |x: []int, ev| x.shorten 1
let resetAll = toEffect |x: []int, ev| [x.length: 0]

//view
let counter = |count: int, a|
    div [style "width: 100%;"], [
        button [onClick add, a], "+"
        span [], " {count} "
        button [onClick sub, a], "-"
        button [onClick reset, a], " reset"
    ]

let list = |elem: []int, a|
    div [], [
        h1 [], "Dynamic Lise"
        button [onClick append, a], "Add Counter"
        button [onClick remove, a], "Remove Counter"
        button [onClick resetAll, a], "Reset All Counter"
        br, br
        div [], mapView counter, elem, a
    ]

//init
app list, newAtom [0]
*/